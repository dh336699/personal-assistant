"use strict";const t=require("../../common/vendor.js"),e=require("../auth/index.js"),o=require("./http.js"),i=require("../../config/index.js"),n=require("./helper.js"),r={beforeRequestHook:(t,o)=>{const{apiUrl:i,joinPrefix:r,urlPrefix:s,joinTime:a}=o;let{url:p,method:c,data:u,header:l}=t;r&&s&&(p=`${s}${p}`),i&&"string"==typeof i&&(p=`${i}${p}`),!u instanceof Object?u=Object.assign({},u,n.joinTimestamp(a,!1)):("GET"===c.toUpperCase()&&"string"==typeof u||"number"==typeof u)&&(p=`${p}/${u}`+n.joinTimestamp(a,!0));const h=e.getToken();return h&&withToken&&(l.Authorization=o.authenticationScheme?`${o.authenticationScheme} ${h}`:h),{...t,url:p,method:c,data:u,header:l}},transformResponseHook:(e,o)=>{const{isTransformResponse:i,isReturnNativeResponse:n,modal:r}=o;if(n)return e;if(!i)return e.data;const{data:s}=e;if(!s)throw new Error("请求失败");const{code:a,result:p,msg:c,status:u}=s;console.log(s,"data");if(200===a||0===u)return r&&("toast"===r.type?t.index.showToast({title:r.content,icon:r.icon}):t.index.showModal({title:r.title||"提示",content:r.content})),p;let l="";if(502===a)l="请求超时",useUserStoreWithOut();else c&&(l=c);throw r&&("toast"===r.type?t.index.showToast({title:"请求失败，请稍后再试",icon:"error"}):t.index.showModal({title:"提示",content:"请求失败，请稍后再试"})),new Error(l||"请求失败")}};function s(t){return new o.Http(Object.assign({},{header:{"Content-Type":"application/json;charset=UTF-8"},transform:r,authenticationScheme:"Bearer",joinPrefix:!0,urlPrefix:i.globSetting.urlPrefix,apiUrl:i.globSetting.apiUrl,joinTime:!0,isTransformResponse:!0,isReturnNativeResponse:!1,withToken:!0},t))}s(),s({apiUrl:"http://api.moonapi.com"});const a=s({apiUrl:"https://apis.tianapi.com"}),p=s({apiUrl:"https://api.jisuapi.com"});exports.jisuHttp=p,exports.tianHttp=a;

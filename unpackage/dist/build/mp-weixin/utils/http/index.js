"use strict";const t=require("../../common/vendor.js"),e=require("../auth/index.js"),o=require("./http.js"),i=require("../../config/index.js"),r=require("./helper.js"),n={beforeRequestHook:(t,o)=>{const{apiUrl:i,joinPrefix:n,urlPrefix:s,joinTime:a}=o;let{url:p,method:c,data:u,header:h}=t;n&&s&&(p=`${s}${p}`),i&&"string"==typeof i&&(p=`${i}${p}`),!u instanceof Object?u=Object.assign({},u,r.joinTimestamp(a,!1)):("GET"===c.toUpperCase()&&"string"==typeof u||"number"==typeof u)&&(p=`${p}/${u}`+r.joinTimestamp(a,!0));const l=e.getToken();return l&&withToken&&(h.Authorization=o.authenticationScheme?`${o.authenticationScheme} ${l}`:l),{...t,url:p,method:c,data:u,header:h}},transformResponseHook:(e,o)=>{const{isTransformResponse:i,isReturnNativeResponse:r,modal:n}=o;if(r)return e;if(!i)return e.data;const{data:s}=e;if(!s)throw new Error("请求失败");const{code:a,result:p,msg:c,status:u,showapi_res_code:h,showapi_res_body:l,error_code:d}=s;if(200===a||0===u||0===h||0===d)return n&&("toast"===n.type?t.index.showToast({title:n.content,icon:n.icon}):t.index.showModal({title:n.title||"提示",content:n.content})),p||(null==l?void 0:l.data)||l;let m="";if(502===a)m="请求超时",useUserStoreWithOut();else c&&(m=c);throw n&&("toast"===n.type?t.index.showToast({title:"请求失败，请稍后再试",icon:"error"}):t.index.showModal({title:"提示",content:"请求失败，请稍后再试"})),new Error(m||"请求失败")}};function s(t){return new o.Http(Object.assign({},{header:{"Content-Type":"application/json;charset=UTF-8"},transform:n,authenticationScheme:"Bearer",joinPrefix:!0,urlPrefix:i.globSetting.urlPrefix,apiUrl:i.globSetting.apiUrl,joinTime:!0,isTransformResponse:!0,isReturnNativeResponse:!1,withToken:!0},t))}const a=s();s({apiUrl:"http://api.moonapi.com"});const p=s({apiUrl:"https://apis.tianapi.com"}),c=s({apiUrl:"https://api.jisuapi.com"}),u=s({apiUrl:"https://route.showapi.com"});exports.defHttp=a,exports.jisuHttp=c,exports.tianHttp=p,exports.wanweiHttp=u;
